<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="header-left">
      <text class="back-btn" bindtap="navigateBack">â€¹</text>
      <text class="header-title">è§£æå¤ä¹ </text>
    </view>
    <view class="header-right">
      <text class="mode-btn" bindtap="showModeSelection">
        {{reviewMode === 'random' ? 'éšæœº' : reviewMode === 'favorite' ? 'æ”¶è—' : 'æœ€è¿‘'}}
      </text>
    </view>
  </view>

  <!-- è¿›åº¦æ¡ -->
  <view class="progress-bar">
    <view class="progress-info">
      <text class="progress-text">{{reviewProgress.current + 1}} / {{reviewProgress.total}}</text>
    </view>
    <view class="progress-track">
      <view 
        class="progress-fill" 
        style="width: {{reviewProgress.total > 0 ? (reviewProgress.current + 1) / reviewProgress.total * 100 : 0}}%"
      ></view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-state">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{reviewList.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">æš‚æ— å¯å¤ä¹ çš„å†…å®¹</text>
    <text class="empty-subtitle">å…ˆå»è§£æä¸€äº›æ—¥è¯­å¥å­å§</text>
  </view>

  <!-- å¤ä¹ å†…å®¹ -->
  <view wx:else class="review-content">
    <!-- å¥å­å¡ç‰‡ -->
    <view class="sentence-card">
      <!-- åŸå§‹å†…å®¹æç¤ºï¼ˆå¦‚æœæ˜¯å›¾ç‰‡ï¼‰ -->
      <view wx:if="{{currentItem.inputMethod === 'image' && currentItem.imageUrl}}" class="original-source">
        <text class="source-label">æ¥æºï¼šå›¾ç‰‡è¯†åˆ«</text>
        <text class="view-source-btn" bindtap="viewOriginalImage">æŸ¥çœ‹åŸå›¾</text>
      </view>
      
      <!-- æ—¥æ–‡åŸæ–‡ -->
      <view class="sentence-main">
        <text class="japanese-text">{{currentSentence.originalText}}</text>
        <view class="sentence-actions">
          <text class="action-btn" bindtap="playPronunciation">ğŸ”Š</text>
        </view>
      </view>

      <!-- ç½—é©¬éŸ³ï¼ˆç‚¹å‡»æ˜¾ç¤ºç­”æ¡ˆåæ˜¾ç¤ºï¼‰ -->
      <view wx:if="{{showAnswer}}" class="sentence-romaji">
        <text class="romaji-text">{{currentSentence.romaji}}</text>
      </view>

      <!-- ç¿»è¯‘ï¼ˆç‚¹å‡»æ˜¾ç¤ºç­”æ¡ˆåæ˜¾ç¤ºï¼‰ -->
      <view wx:if="{{showAnswer}}" class="sentence-translation">
        <text class="translation-text">{{currentSentence.translation}}</text>
      </view>

      <!-- ç­”æ¡ˆè¯¦æƒ… -->
      <view wx:if="{{showAnswer}}" class="answer-details">
        <!-- å¥å­ç»“æ„ -->
        <view class="detail-section">
          <text class="detail-label">å¥å­ç»“æ„</text>
          <text class="detail-content">{{currentSentence.structure}}</text>
        </view>

        <!-- è¯­æ³•ç‚¹ -->
        <view class="detail-section">
          <text class="detail-label">è¯­æ³•ç‚¹</text>
          <text class="detail-content grammar-content">{{currentSentence.grammar}}</text>
        </view>

        <!-- è¯æ±‡è¡¨ -->
        <view wx:if="{{currentSentence.vocabulary && currentSentence.vocabulary.length > 0}}" class="detail-section">
          <text class="detail-label">è¯æ±‡æ˜ç»†</text>
          <view class="vocabulary-list">
            <view wx:for="{{currentSentence.vocabulary}}" wx:key="index" class="vocab-item">
              <text class="vocab-text">{{item.japanese}} | {{item.romaji}} | {{item.chinese}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <!-- æ˜¾ç¤º/éšè—ç­”æ¡ˆ -->
      <button 
        wx:if="{{!showAnswer}}" 
        class="btn-primary" 
        bindtap="showAnswerDetail"
      >
        æ˜¾ç¤ºç­”æ¡ˆ
      </button>

      <!-- æŒæ¡ç¨‹åº¦é€‰æ‹© -->
      <view wx:else class="mastery-buttons">
        <button 
          class="btn-difficult" 
          bindtap="markMastery" 
          data-mastered="{{false}}"
        >
          è¿˜éœ€ç»ƒä¹ 
        </button>
        <button 
          class="btn-easy" 
          bindtap="markMastery" 
          data-mastered="{{true}}"
        >
          å·²æŒæ¡
        </button>
      </view>
    </view>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <view class="nav-buttons">
      <button 
        class="btn-nav {{currentIndex === 0 ? 'disabled' : ''}}" 
        bindtap="prevSentence"
        disabled="{{currentIndex === 0}}"
      >
        ä¸Šä¸€ä¸ª
      </button>
      <button class="btn-nav-primary" bindtap="nextSentence">
        {{currentIndex < reviewList.length - 1 ? 'ä¸‹ä¸€ä¸ª' : 'å®Œæˆ'}}
      </button>
    </view>

    <!-- åº•éƒ¨å·¥å…·æ  -->
    <view class="toolbar">
      <text class="tool-btn" bindtap="saveToWordbook">ğŸ“ ä¿å­˜è¯æ±‡</text>
      <text class="tool-btn" bindtap="hideAnswer">ğŸ‘ï¸ éšè—ç­”æ¡ˆ</text>
    </view>
  </view>

  <!-- æ¨¡å¼é€‰æ‹©å¼¹çª— -->
  <view wx:if="{{showModeSelect}}" class="mode-modal">
    <view class="mode-container">
      <view class="mode-header">
        <text class="mode-title">é€‰æ‹©å¤ä¹ æ¨¡å¼</text>
        <text class="close-btn" bindtap="hideModeSelection">Ã—</text>
      </view>
      
      <view class="mode-list">
        <view 
          class="mode-item {{reviewMode === 'random' ? 'active' : ''}}"
          bindtap="switchMode"
          data-mode="random"
        >
          <text class="mode-name">ğŸ² éšæœºå¤ä¹ </text>
          <text class="mode-desc">éšæœºé¡ºåºå¤ä¹ æ‰€æœ‰å¥å­</text>
        </view>
        
        <view 
          class="mode-item {{reviewMode === 'favorite' ? 'active' : ''}}"
          bindtap="switchMode"
          data-mode="favorite"
        >
          <text class="mode-name">â­ æ”¶è—å¤ä¹ </text>
          <text class="mode-desc">åªå¤ä¹ æ”¶è—çš„å¥å­</text>
        </view>
        
        <view 
          class="mode-item {{reviewMode === 'recent' ? 'active' : ''}}"
          bindtap="switchMode"
          data-mode="recent"
        >
          <text class="mode-name">ğŸ• æœ€è¿‘å¤ä¹ </text>
          <text class="mode-desc">æŒ‰æ—¶é—´é¡ºåºå¤ä¹ æœ€è¿‘çš„å¥å­</text>
        </view>
      </view>
    </view>
  </view>
</view>