<!-- pages/learning-plan/learning-plan.wxml -->
<view class="container">
  <!-- å­¦ä¹ è¿›åº¦å¡ç‰‡ -->
  <view class="progress-card">
    <view class="progress-header">
      <text class="progress-title">å­¦ä¹ è¿›åº¦</text>
      <text class="progress-subtitle">JLPT N2 è¯æ±‡ç³»ç»Ÿ</text>
    </view>
    
    <view class="progress-stats">
      <view class="stat-item">
        <text class="stat-value">{{progress.learnedWords}}</text>
        <text class="stat-label">å·²å­¦ä¹ </text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{progress.masteredWords}}</text>
        <text class="stat-label">å·²æŒæ¡</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{progress.totalWords}}</text>
        <text class="stat-label">æ€»è¯æ±‡</text>
      </view>
    </view>
    
    <!-- è¿›åº¦æ¡ -->
    <view class="progress-bar-wrapper">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progress.learnedWords / progress.totalWords * 100}}%"></view>
      </view>
      <text class="progress-percent">{{progress.progressPercent}}%</text>
    </view>
    
    <!-- è¿ç»­å­¦ä¹  -->
    <view class="streak-info">
      <text class="streak-icon">ğŸ”¥</text>
      <text class="streak-text">è¿ç»­å­¦ä¹  {{progress.consecutiveDays}} å¤©</text>
    </view>
  </view>

  <!-- ä»Šæ—¥ä»»åŠ¡ -->
  <view class="today-card">
    <view class="card-header">
      <text class="card-title">ä»Šæ—¥ä»»åŠ¡</text>
      <text class="card-date">{{todayDate}}</text>
    </view>
    
    <view class="task-summary">
      <view class="task-item">
        <view class="task-icon new-icon">æ–°</view>
        <view class="task-info">
          <text class="task-name">æ–°è¯å­¦ä¹ </text>
          <text class="task-progress">{{progress.todayNewWords}} / {{planConfig.dailyNewWords}}</text>
        </view>
        <view class="task-status {{progress.todayNewWords >= planConfig.dailyNewWords ? 'completed' : ''}}">
          {{progress.todayNewWords >= planConfig.dailyNewWords ? 'âœ“' : progress.todayNewWords + '/' + planConfig.dailyNewWords}}
        </view>
      </view>
      
      <view class="task-item">
        <view class="task-icon review-icon">å¤</view>
        <view class="task-info">
          <text class="task-name">è¯æ±‡å¤ä¹ </text>
          <text class="task-progress">{{progress.todayReviewWords}} / {{planConfig.dailyReviewWords}}</text>
        </view>
        <view class="task-status {{progress.todayReviewWords >= planConfig.dailyReviewWords ? 'completed' : ''}}">
          {{progress.todayReviewWords >= planConfig.dailyReviewWords ? 'âœ“' : progress.todayReviewWords + '/' + planConfig.dailyReviewWords}}
        </view>
      </view>
    </view>
    
    <button class="start-btn {{todayTasks.completed ? 'completed-btn' : ''}}" bindtap="startLearning">
      {{todayTasks.completed ? 'ä»Šæ—¥å·²å®Œæˆ âœ“' : 'å¼€å§‹å­¦ä¹ '}}
    </button>
  </view>

  <!-- å­¦ä¹ è®¡åˆ’é…ç½® -->
  <view class="config-card">
    <view class="card-header" bindtap="toggleConfig">
      <text class="card-title">å­¦ä¹ è®¡åˆ’è®¾ç½®</text>
      <text class="toggle-icon">{{showConfig ? 'â–²' : 'â–¼'}}</text>
    </view>
    
    <view wx:if="{{showConfig}}" class="config-content">
      <!-- éš¾åº¦é€‰æ‹© -->
      <view class="config-item">
        <text class="config-label">å­¦ä¹ éš¾åº¦</text>
        <view class="difficulty-options">
          <view wx:for="{{difficultyOptions}}" wx:key="value" 
                class="difficulty-option {{planConfig.difficulty === item.value ? 'active' : ''}}"
                bindtap="onDifficultyChange" data-value="{{item.value}}">
            <text class="difficulty-name">{{item.label}}</text>
            <text class="difficulty-desc">æ¯æ—¥{{item.newWords}}æ–°è¯</text>
          </view>
        </view>
      </view>
      
      <!-- æ¯æ—¥æ–°è¯æ•° -->
      <view class="config-item">
        <text class="config-label">æ¯æ—¥æ–°è¯æ•°é‡</text>
        <view class="config-control">
          <slider value="{{planConfig.dailyNewWords}}" 
                  min="1" max="50" step="1"
                  bindchange="onDailyNewWordsChange"
                  block-size="20" />
          <text class="config-value">{{planConfig.dailyNewWords}} ä¸ª</text>
        </view>
      </view>
      
      <!-- æ¯æ—¥å¤ä¹ æ•° -->
      <view class="config-item">
        <text class="config-label">æ¯æ—¥å¤ä¹ æ•°é‡</text>
        <view class="config-control">
          <slider value="{{planConfig.dailyReviewWords}}" 
                  min="5" max="100" step="5"
                  bindchange="onDailyReviewWordsChange"
                  block-size="20" />
          <text class="config-value">{{planConfig.dailyReviewWords}} ä¸ª</text>
        </view>
      </view>
      
      <!-- å­¦ä¹ æ¨¡å¼ -->
      <view class="config-item">
        <text class="config-label">å­¦ä¹ æ¨¡å¼</text>
        <view class="mode-options">
          <view wx:for="{{studyModeOptions}}" wx:key="value"
                class="mode-option {{planConfig.studyMode === item.value ? 'active' : ''}}"
                bindtap="onStudyModeChange" data-value="{{item.value}}">
            {{item.label}}
          </view>
        </view>
      </view>
      
      <!-- é‡ç‚¹åˆ†ç±» -->
      <view class="config-item">
        <text class="config-label">é‡ç‚¹å­¦ä¹ åˆ†ç±»</text>
        <view class="category-list">
          <view wx:for="{{categories}}" wx:key="value"
                class="category-tag {{item.selected ? 'selected' : ''}}"
                bindtap="onCategorySelect" data-value="{{item.value}}">
            {{item.label}} ({{item.count}})
          </view>
        </view>
      </view>
      
      <!-- è§£æå†å²æ ‡ç­¾ç­›é€‰ -->
      <view class="config-item">
        <text class="config-label">è§£æå†å²æ ‡ç­¾ç­›é€‰</text>
        <view class="tag-filter-section">
          <view class="filter-tabs">
            <view class="filter-tab {{contentSource === 'vocabulary' ? 'active' : ''}}"
                  bindtap="onContentSourceChange" data-source="vocabulary">
              JLPTè¯æ±‡
            </view>
            <view class="filter-tab {{contentSource === 'history' ? 'active' : ''}}"
                  bindtap="onContentSourceChange" data-source="history">
              è§£æå†å²
            </view>
          </view>
          
          <view wx:if="{{contentSource === 'history'}}" class="history-tags">
            <view wx:if="{{historyTags.length === 0}}" class="no-tags">
              <text class="no-tags-text">æš‚æ— è§£æå†å²æ ‡ç­¾</text>
              <text class="no-tags-hint">å»è§£æé¡µé¢ä¸ºè®°å½•æ·»åŠ æ ‡ç­¾</text>
            </view>
            <view wx:else class="tag-list">
              <view wx:for="{{historyTags}}" wx:key="tag"
                    class="history-tag {{item.selected ? 'selected' : ''}}"
                    bindtap="onHistoryTagSelect" data-tag="{{item.tag}}">
                {{item.tag}} ({{item.count}})
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- å­¦ä¹ æé†’ -->
      <view class="config-item">
        <text class="config-label">å­¦ä¹ æé†’</text>
        <view class="reminder-setting">
          <switch checked="{{planConfig.enableReminder}}" 
                  bindchange="onReminderChange" />
          <picker wx:if="{{planConfig.enableReminder}}" 
                  mode="time" value="{{planConfig.studyTime}}"
                  bindchange="onStudyTimeChange">
            <view class="time-picker">
              <text>æ¯æ—¥ {{planConfig.studyTime}}</text>
              <text class="arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>
      
      <!-- ä¿å­˜æŒ‰é’® -->
      <button class="save-config-btn" bindtap="saveConfig">ä¿å­˜è®¾ç½®</button>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="viewVocabulary">
      <view class="action-icon">ğŸ“š</view>
      <text class="action-name">è¯æ±‡åº“</text>
    </view>
    <view class="action-item" bindtap="viewHistory">
      <view class="action-icon">ğŸ“Š</view>
      <text class="action-name">å­¦ä¹ è®°å½•</text>
    </view>
    <view class="action-item" bindtap="startLearning">
      <view class="action-icon">ğŸ¯</view>
      <text class="action-name">å¿«é€Ÿå­¦ä¹ </text>
    </view>
    <view class="action-item" open-type="share">
      <view class="action-icon">ğŸ“¤</view>
      <text class="action-name">åˆ†äº«</text>
    </view>
  </view>

  <!-- ä»Šæ—¥è¯æ±‡é¢„è§ˆ -->
  <view wx:if="{{todayTasks.newWords.length > 0}}" class="words-preview">
    <view class="preview-header">
      <text class="preview-title">ä»Šæ—¥æ–°è¯é¢„è§ˆ</text>
      <text class="preview-count">å…± {{todayTasks.newWords.length}} ä¸ª</text>
    </view>
    <scroll-view class="preview-list" scroll-x>
      <view wx:for="{{todayTasks.newWords}}" wx:key="_id" class="preview-item">
        <text class="preview-word">{{item.word}}</text>
        <text class="preview-reading">{{item.reading}}</text>
      </view>
    </scroll-view>
  </view>
</view>