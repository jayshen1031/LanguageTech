<view class="container">
  <!-- é¡¶éƒ¨ç®€æ´æ ‡é¢˜ -->
  <view class="header-simple">
    <text class="header-title">æ—¥è¯­è§£æ</text>
    <text class="history-btn" bindtap="viewHistory">å†å²</text>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- è¾“å…¥æ–¹å¼åˆ‡æ¢ -->
    <view class="method-switch">
      <view 
        class="method-btn {{inputMethod === 'text' ? 'active' : ''}}"
        bindtap="switchInputMethod"
        data-method="text"
      >
        <text>æ–‡æœ¬</text>
      </view>
      <view 
        class="method-btn {{inputMethod === 'image' ? 'active' : ''}}"
        bindtap="switchInputMethod"
        data-method="image"
      >
        <text>å›¾ç‰‡</text>
      </view>
    </view>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <view class="input-area">
      <!-- æ–‡æœ¬è¾“å…¥ -->
      <view wx:if="{{inputMethod === 'text'}}" class="text-mode">
        <textarea 
          class="text-input"
          placeholder="è¯·è¾“å…¥æ—¥è¯­æ–‡æœ¬ï¼ˆå¦‚ï¼šç§ã¯å­¦ç”Ÿã§ã™ï¼‰"
          placeholder-class="placeholder"
          value="{{inputText}}"
          bindinput="onTextInput"
          maxlength="500"
        />
        <view class="input-footer">
          <text class="char-count">{{inputText.length}}/500</text>
        </view>
      </view>

      <!-- å›¾ç‰‡è¾“å…¥ -->
      <view wx:else class="image-mode">
        <view wx:if="{{!imageUrl}}" class="upload-box" bindtap="chooseImage">
          <view class="upload-icon">+</view>
          <text class="upload-text">ä¸Šä¼ å›¾ç‰‡</text>
        </view>
        <view wx:else class="image-container">
          <image src="{{imageUrl}}" mode="aspectFit" class="preview-image" />
          <view class="image-overlay" bindtap="chooseImage">
            <text>ç‚¹å‡»æ›´æ¢</text>
          </view>
        </view>
        
        <!-- å›¾ç‰‡æ¨¡å¼æç¤º -->
        <view wx:if="{{imageUrl && inputMethod === 'image'}}" class="image-tip">
          <text class="tip-text">ç‚¹å‡»"å¼€å§‹è§£æ"ï¼ŒAzure GPT-4o å°†ç›´æ¥è¯†åˆ«å¹¶åˆ†æå›¾ç‰‡ä¸­çš„æ—¥è¯­å†…å®¹</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-bar">
      <button 
        class="btn-analyze {{((!inputText && inputMethod === 'text') || (!imageUrl && inputMethod === 'image') || isAnalyzing) ? 'disabled' : ''}}" 
        bindtap="startAnalysis"
        disabled="{{(!inputText && inputMethod === 'text') || (!imageUrl && inputMethod === 'image') || isAnalyzing}}"
      >
        {{isAnalyzing ? 'è§£æä¸­...' : 'å¼€å§‹è§£æ'}}
      </button>
      <button class="btn-clear" bindtap="clearContent" wx:if="{{inputText || imageUrl}}">æ¸…ç©º</button>
    </view>
    
    <!-- å¤ä¹ å…¥å£å·²ç§»è‡³å†å²é¡µé¢ -->
    
    
  </view>

  <!-- è§£æç»“æœ -->
  <view wx:if="{{showResult}}" class="result-container">
    <view class="result-header">
      <text class="result-title">è§£æç»“æœ</text>
      <view class="result-actions">
        <text class="save-btn" bindtap="manualSaveToHistory">ä¿å­˜åˆ°å†å²</text>
        <text class="copy-btn" bindtap="copyResult">å¤åˆ¶å…¨éƒ¨</text>
      </view>
    </view>
    
    <!-- æ–‡ç« æ ‡é¢˜ï¼ˆä»…å›¾ç‰‡æ¨¡å¼ï¼‰ -->
    <view wx:if="{{articleTitle && inputMethod === 'image'}}" class="article-title-container">
      <text class="article-title">{{articleTitle}}</text>
    </view>

    <!-- å¹³é“ºå±•ç¤ºè§£æç»“æœ -->
    <view class="result-content">
      <!-- å•è¯ç±»å‹æ˜¾ç¤º -->
      <block wx:if="{{analysisResult[0] && analysisResult[0].isWord}}">
        <view wx:for="{{analysisResult}}" wx:key="index" class="result-flat word-result">
          <!-- è¯æ±‡ç¼–å· -->
          <view class="result-row">
            <text class="row-label">ğŸ“˜ è¯æ±‡{{item.index}}</text>
            <view class="result-actions">
              <text class="save-link" bindtap="saveWordToWordbook" data-word="{{item}}">ä¿å­˜åˆ°ç”Ÿè¯æœ¬</text>
            </view>
          </view>
          
          <!-- æ—¥æ–‡ -->
          <view class="result-row">
            <text class="row-label">ã€æ—¥æ–‡ã€‘</text>
            <text class="row-value japanese large">{{item.word}}</text>
          </view>
          
          <!-- å‡å -->
          <view class="result-row">
            <text class="row-label">ã€å‡åã€‘</text>
            <text class="row-value kana">{{item.kana}}</text>
          </view>
          
          <!-- ç½—é©¬éŸ³ -->
          <view class="result-row">
            <text class="row-label">ã€ç½—é©¬éŸ³ã€‘</text>
            <text class="row-value romaji">{{item.romaji}}</text>
          </view>
          
          <!-- è¯æ€§ -->
          <view class="result-row">
            <text class="row-label">ã€è¯æ€§ã€‘</text>
            <text class="row-value part-of-speech">{{item.partOfSpeech}}</text>
          </view>
          
          <!-- ä¸­æ–‡å«ä¹‰ -->
          <view class="result-row">
            <text class="row-label">ã€ä¸­æ–‡å«ä¹‰ã€‘</text>
            <text class="row-value meaning">{{item.meaning}}</text>
          </view>
          
          <!-- è¯æºè¯´æ˜ -->
          <view wx:if="{{item.etymology}}" class="result-row align-top">
            <text class="row-label">ã€è¯æºè¯´æ˜ã€‘</text>
            <text class="row-value etymology">{{item.etymology}}</text>
          </view>
          
          <!-- å¸¸ç”¨æ­é… -->
          <view wx:if="{{item.collocations && item.collocations.length > 0}}" class="result-row align-top">
            <text class="row-label">ã€å¸¸ç”¨æ­é…ã€‘</text>
            <view class="collocation-list">
              <view wx:for="{{item.collocations}}" wx:for-item="coll" wx:key="index" class="collocation-item">
                <text>â€¢ {{coll.japanese}} ({{coll.kana}}) - {{coll.chinese}}</text>
              </view>
            </view>
          </view>
          
          <!-- ä¾‹å¥ -->
          <view wx:if="{{item.examples && item.examples.length > 0}}" class="result-row align-top">
            <text class="row-label">ã€ä¾‹å¥ã€‘</text>
            <view class="example-list">
              <view wx:for="{{item.examples}}" wx:for-item="ex" wx:for-index="exIndex" wx:key="exIndex" class="example-item">
                <text class="ex-jp">{{exIndex + 1}}. {{ex.jp}}</text>
                <text class="ex-kana" wx:if="{{ex.kana}}">   {{ex.kana}}</text>
                <text class="ex-cn">   {{ex.cn}}</text>
              </view>
            </view>
          </view>
          
          <!-- è¿‘ä¹‰è¯ -->
          <view wx:if="{{item.synonyms}}" class="result-row">
            <text class="row-label">ã€è¿‘ä¹‰è¯ã€‘</text>
            <text class="row-value synonyms">{{item.synonyms}}</text>
          </view>
          
          <!-- åä¹‰è¯ -->
          <view wx:if="{{item.antonyms}}" class="result-row">
            <text class="row-label">ã€åä¹‰è¯ã€‘</text>
            <text class="row-value antonyms">{{item.antonyms}}</text>
          </view>
          
          <!-- è®°å¿†æŠ€å·§ -->
          <view wx:if="{{item.memoryTip}}" class="result-row align-top">
            <text class="row-label">ã€è®°å¿†æŠ€å·§ã€‘</text>
            <text class="row-value memory-tip">{{item.memoryTip}}</text>
          </view>
        </view>
      </block>
      
      <!-- å¥å­ç±»å‹æ˜¾ç¤ºï¼ˆåŸæœ‰çš„ï¼‰ -->
      <block wx:else>
        <view wx:for="{{analysisResult}}" wx:key="index" class="result-flat">
          <!-- å¥å­ç¼–å· -->
          <view class="result-row">
            <text class="row-label">ğŸ“˜ ç¬¬{{item.index}}å¥</text>
            <view class="result-actions">
              <text class="save-link" bindtap="saveToWordbook" data-sentence="{{item}}">ä¿å­˜è¯æ±‡</text>
            </view>
          </view>
        
        <!-- æ—¥æ–‡åŸæ–‡ -->
        <view class="result-row">
          <text class="row-label">ã€æ—¥æ–‡åŸæ–‡ã€‘</text>
          <text class="row-value japanese">{{item.originalText}}</text>
        </view>
        
        <!-- ç½—é©¬éŸ³ -->
        <view class="result-row">
          <text class="row-label">ã€ç½—é©¬éŸ³ã€‘</text>
          <text class="row-value romaji">{{item.romaji}}</text>
        </view>
        
        <!-- ä¸­æ–‡ç¿»è¯‘ -->
        <view class="result-row">
          <text class="row-label">ã€ä¸­æ–‡ç¿»è¯‘ã€‘</text>
          <text class="row-value translation">{{item.translation}}</text>
        </view>
        
        <!-- ç²¾ç®€ç»“æ„ -->
        <view class="result-row">
          <text class="row-label">ã€ç²¾ç®€ç»“æ„ã€‘</text>
          <text class="row-value structure">{{item.structure}}</text>
        </view>
        
        <!-- å¥å­ç»“æ„åˆ†æ -->
        <view class="result-row align-top">
          <text class="row-label">ã€å¥å­ç»“æ„åˆ†æã€‘</text>
          <text class="row-value detail">{{item.analysis}}</text>
        </view>
        
        <!-- è¯­æ³•ç‚¹è¯´æ˜ -->
        <view class="result-row align-top">
          <text class="row-label">ã€è¯­æ³•ç‚¹è¯´æ˜ã€‘</text>
          <text class="row-value grammar">{{item.grammar}}</text>
        </view>
        
        <!-- è¯æ±‡æ˜ç»†è¡¨ -->
        <view class="result-row align-top">
          <text class="row-label">ã€è¯æ±‡æ˜ç»†è¡¨ã€‘</text>
          <view class="vocab-table-flat">
            <view wx:for="{{item.vocabulary}}" wx:for-item="vocab" wx:key="index" class="vocab-row-flat">
              <text class="vocab-cell">{{vocab.japanese}}ï½œ{{vocab.romaji}}ï½œ{{vocab.chinese}}</text>
            </view>
          </view>
        </view>
        
        <!-- åˆ†éš”çº¿ -->
        <view class="result-divider" wx:if="{{index < analysisResult.length - 1}}"></view>
      </view>
      </block>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€æç¤º -->
  <view wx:if="{{!showResult && !isAnalyzing && !inputText && !imageUrl}}" class="empty-state">
    <text class="empty-icon">ğŸ“</text>
    <text class="empty-text">è¾“å…¥æ—¥è¯­æ–‡æœ¬æˆ–ä¸Šä¼ å›¾ç‰‡å¼€å§‹è§£æ</text>
  </view>

  <!-- å†å²è®°å½•åŠŸèƒ½å·²ç§»è‡³ç‹¬ç«‹é¡µé¢ -->
</view>