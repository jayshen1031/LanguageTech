<!-- pages/history-vocabulary/history-vocabulary.wxml -->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯æ±‡è¡¨å†…å®¹ -->
  <view wx:else class="vocab-content">
    <!-- å¤´éƒ¨å·¥å…·æ  -->
    <view class="header-toolbar">
      <view class="search-bar">
        <input 
          class="search-input" 
          placeholder="æœç´¢è¯æ±‡..." 
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
        />
      </view>
      
      <view class="stats-info">
        <text class="total-count">å…±{{filteredList.length}}ä¸ªè¯æ±‡</text>
        <text class="selected-count" wx:if="{{selectedWords.length > 0}}">å·²é€‰{{selectedWords.length}}ä¸ª</text>
      </view>
    </view>

    <!-- æ“ä½œæ  -->
    <view class="action-bar">
      <view class="select-actions">
        <button class="btn-select-all {{selectAll ? 'active' : ''}}" bindtap="onSelectAll">
          {{selectAll ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}
        </button>
      </view>
      
      <button 
        class="btn-add-to-study {{selectedWords.length === 0 ? 'disabled' : ''}}" 
        bindtap="addToStudyPlan"
        disabled="{{selectedWords.length === 0}}"
      >
        åŠ å…¥å­¦ä¹ è®¡åˆ’ ({{selectedWords.length}})
      </button>
    </view>

    <!-- è¯æ±‡åˆ—è¡¨ -->
    <scroll-view class="vocab-list" scroll-y="true">
      <view wx:if="{{filteredList.length === 0}}" class="empty-state">
        <text class="empty-text">{{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è¯æ±‡' : 'æš‚æ— è¯æ±‡'}}</text>
      </view>

      <view wx:for="{{filteredList}}" wx:key="japanese" class="vocab-item">
        <view class="vocab-checkbox" bindtap="onSelectWord" data-index="{{index}}">
          <view class="checkbox {{item.isSelected ? 'checked' : ''}}">
            <text wx:if="{{item.isSelected}}" class="check-icon">âœ“</text>
          </view>
        </view>

        <view class="vocab-info" bindtap="onPreviewWord" data-word="{{item}}">
          <view class="vocab-main">
            <text class="japanese-text">{{item.japanese}}</text>
            <text class="chinese-text">{{item.chinese}}</text>
          </view>
          <view class="vocab-sub">
            <text class="romaji-text">{{item.romaji}}</text>
            <text class="status-tag" wx:if="{{item.addedToStudy}}">å·²åŠ å…¥</text>
          </view>
          <view class="vocab-sources" wx:if="{{item.sources}}">
            <text class="sources-label">ğŸ“š å‡ºç°åœ¨:</text>
            <view class="sources-list">
              <view wx:for="{{item.sources}}" wx:for-item="source" wx:key="recordId" class="source-item">
                <text class="source-title">ã€Š{{source.recordTitle}}ã€‹</text>
                <text class="source-detail">ç¬¬{{source.sentenceIndex}}å¥</text>
              </view>
            </view>
            <text class="sources-count" wx:if="{{item.sources.length > 1}}">ç­‰{{item.sources.length}}å¤„</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-bar">
      <button class="btn-back" bindtap="onBack">è¿”å›</button>
      <button 
        class="btn-add-selected {{selectedWords.length === 0 ? 'disabled' : ''}}" 
        bindtap="addToStudyPlan"
        disabled="{{selectedWords.length === 0}}"
      >
        æ·»åŠ é€‰ä¸­è¯æ±‡
      </button>
    </view>
  </view>
</view>