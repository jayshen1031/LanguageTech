<!-- pages/vocabulary-list/vocabulary-list.wxml -->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="title-section">
      <text class="page-title">{{pageTitle}}</text>
      <text class="word-count">å…± {{totalCount}} ä¸ªè¯æ±‡</text>
      <text wx:if="{{vocabularyList.length < totalCount}}" class="load-hint">
        å½“å‰æ˜¾ç¤º {{vocabularyList.length}} ä¸ªï¼Œå‘ä¸‹æ»‘åŠ¨åŠ è½½æ›´å¤š
      </text>
      <button wx:if="{{vocabularyList.length < totalCount && hasMore}}" class="load-all-btn" bindtap="loadAllVocabulary">
        ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨
      </button>
    </view>
  </view>

  <!-- è¯æ±‡åˆ—è¡¨ -->
  <scroll-view class="vocabulary-list" scroll-y enable-back-to-top>
    <view wx:for="{{vocabularyList}}" wx:key="_id" class="vocabulary-item">
      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="item-header">
        <view class="item-main">
          <text class="word">{{item.word}}</text>
          <text class="reading">{{item.romaji}}</text>
        </view>
        <view class="item-status">
          <text wx:if="{{item.totalOccurrences >= 3}}" class="status-badge mastered">å·²æŒæ¡</text>
          <text wx:else class="status-badge learning">å­¦ä¹ ä¸­</text>
        </view>
      </view>

      <!-- å«ä¹‰ -->
      <view class="item-meaning">
        <text class="meaning-text">{{item.meaning}}</text>
      </view>

      <!-- å­¦ä¹ ç»Ÿè®¡ -->
      <view class="item-stats">
        <text class="stat-item">å‡ºç° {{item.totalOccurrences}} æ¬¡</text>
        <text wx:if="{{item.examples && item.examples.length > 0}}" class="stat-item">ä¾‹å¥ {{item.examples.length}} ä¸ª</text>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="item-actions">
        <button class="action-btn play-btn" bindtap="playAudio" data-text="{{item.word}}">
          ğŸ”Š å‘éŸ³
        </button>
        <button class="action-btn detail-btn" bindtap="showDetail" data-index="{{index}}">
          ğŸ“– è¯¦æƒ…
        </button>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && vocabularyList.length > 0}}" class="no-more">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && vocabularyList.length === 0}}" class="empty">
      <text class="empty-icon">ğŸ“š</text>
      <text class="empty-text">æš‚æ— {{pageTitle}}</text>
      <text class="empty-hint">å»è§£ææ›´å¤šå†…å®¹æ¥ä¸°å¯Œè¯æ±‡åº“</text>
      <button class="empty-action" bindtap="goToParser">å¼€å§‹è§£æ</button>
    </view>
  </scroll-view>
</view>

<!-- è¯æ±‡è¯¦æƒ…å¼¹çª— -->
<view wx:if="{{showDetailModal}}" class="modal-mask" bindtap="hideDetail">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">è¯æ±‡è¯¦æƒ…</text>
      <text class="modal-close" bindtap="hideDetail">Ã—</text>
    </view>
    
    <view wx:if="{{selectedWord}}" class="modal-body">
      <!-- è¯æ±‡åŸºæœ¬ä¿¡æ¯ -->
      <view class="word-info">
        <text class="word-main">{{selectedWord.word}}</text>
        <text class="word-reading">{{selectedWord.romaji}}</text>
        <text class="word-meaning">{{selectedWord.meaning}}</text>
      </view>

      <!-- å­¦ä¹ ç»Ÿè®¡ -->
      <view class="word-stats">
        <view class="stat-row">
          <text class="stat-label">å‡ºç°æ¬¡æ•°ï¼š</text>
          <text class="stat-value">{{selectedWord.totalOccurrences}} æ¬¡</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">å­¦ä¹ çŠ¶æ€ï¼š</text>
          <text class="stat-value {{selectedWord.totalOccurrences >= 3 ? 'mastered' : 'learning'}}">
            {{selectedWord.totalOccurrences >= 3 ? 'å·²æŒæ¡' : 'å­¦ä¹ ä¸­'}}
          </text>
        </view>
        <view class="stat-row">
          <text class="stat-label">è¯æ±‡çº§åˆ«ï¼š</text>
          <text class="stat-value">{{selectedWord.level}}</text>
        </view>
      </view>

      <!-- ä¾‹å¥ -->
      <view wx:if="{{selectedWord.examples && selectedWord.examples.length > 0}}" class="examples-section">
        <text class="section-title">ä¾‹å¥</text>
        <view wx:for="{{selectedWord.examples}}" wx:key="*this" class="example-item">
          <text class="example-jp">{{item.jp}}</text>
          <text class="example-cn">{{item.cn}}</text>
          <button class="play-example" bindtap="playAudio" data-text="{{item.jp}}">ğŸ”Š</button>
        </view>
      </view>

      <!-- æ¥æºæ ‡ç­¾ -->
      <view wx:if="{{selectedWord.tags && selectedWord.tags.length > 0}}" class="tags-section">
        <text class="section-title">æ ‡ç­¾</text>
        <view class="tag-list">
          <text wx:for="{{selectedWord.tags}}" wx:key="*this" class="tag">{{item}}</text>
        </view>
      </view>
    </view>

    <view class="modal-footer">
      <button class="modal-btn play-btn" bindtap="playAudio" data-text="{{selectedWord.word}}">
        ğŸ”Š æ’­æ”¾å‘éŸ³
      </button>
      <button class="modal-btn close-btn" bindtap="hideDetail">å…³é—­</button>
    </view>
  </view>
</view>