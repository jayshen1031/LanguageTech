# 项目迭代日志

## 2025-01-13
### MCP音频服务开发 - V1.0
- **架构设计**：实现了基于Express的MCP音频服务器
- **TTS功能**：
  - 集成edge-tts支持多语言文字转语音
  - 实现音频缓存机制，提高响应速度
  - 支持日语、英语、中文多种声音选择
  - 添加批量TTS生成功能
- **小程序集成**：
  - 创建audioMCP工具类封装API调用
  - 实现音频播放控制和错误处理
  - 添加本地缓存优化性能
- **降级方案**：
  - MCP服务不可用时自动降级到微信插件
  - 多层降级：MCP -> 插件 -> 云函数 -> 读音显示
- **语音识别**：预留STT接口，支持后续扩展

### 技术亮点
1. **模块化设计**：MCP服务独立运行，便于维护和扩展
2. **缓存优化**：基于MD5的文件缓存，避免重复生成
3. **错误处理**：完善的降级机制，保证用户体验
4. **批量处理**：支持批量音频生成，优化性能

### 待优化项
- 集成真实的语音识别服务
- 添加更多TTS引擎选项
- 实现音频质量设置
- 支持SSML语音标记

## 2025-07-13

### 项目初始化
- 创建微信小程序基础框架
- 设置项目名称为"语伴君"
- 配置基础页面路由：首页、学习、复习、生词本、AI语法、对话、个人中心
- 设置tabBar包含：首页、学习、生词本、我的
- 配置全局样式主题色为 #4A90E2

### 技术决策
1. **选择原生框架而非框架**
   - 原因：减少学习成本，充分利用微信小程序原生能力
   - 后续可以考虑引入Vant Weapp作为UI组件库

2. **云开发vs自建后端**
   - 选择：优先使用微信云托管
   - 原因：降低运维成本，与小程序深度集成
   - 备选：如果需要更复杂的后端逻辑，可以迁移到自建Node.js服务

3. **AI接口选择**
   - 使用OpenAI GPT-4o
   - 通过云函数中转，避免密钥暴露
   - 考虑成本控制，设置调用频率限制

### 项目结构设计
- pages/: 存放所有页面文件
- components/: 可复用组件
- utils/: 工具函数和API封装
- cloud/: 云函数代码
- images/: 静态图片资源

### 下一步计划
1. 完成核心页面的基础布局 ✓
2. 实现网络请求和授权封装 ✓
3. 创建单词卡片等核心组件
4. 集成云数据库，设计数据结构

## 2025-07-13（续）

### 问题修复
1. **编码问题修复**
   - 修复了多个JSON和WXML文件的UTF-8编码问题
   - 原因：文件创建时编码格式不正确
   - 解决：重新写入所有受影响的文件

2. **权限配置修复**
   - 移除了app.json中无效的scope.record配置
   - 说明：录音权限需要在运行时动态申请

3. **图标文件处理**
   - 暂时移除了tabBar的图标配置
   - 使用emoji作为临时替代方案
   - 后续可添加实际的PNG图标文件

### 音频功能实现
1. **初始方案：音频MCP服务**
   - 创建了独立的音频MCP服务器
   - 提供TTS功能和音频缓存
   - 保留作为开发环境的选项

2. **最终方案：微信原生集成**
   - 集成微信同声传译插件（WechatSI）
   - 创建云函数audio-tts作为备选
   - 实现多级降级策略：插件 → 云函数 → 显示读音

### 项目结构更新
```
LanguageTech/
├── cloudfunctions/     # 新增：云函数目录
│   └── audio-tts/     # 音频TTS云函数
├── audio-mcp-server/  # 音频MCP服务（可选）
└── docs/              # 新增：文档目录
```

### 技术栈补充
- **插件**：微信同声传译插件 (WechatSI)
- **云函数**：用于音频生成和API中转
- **备选方案**：本地MCP服务（开发环境）

### 待办事项
1. **组件开发**（优先级：高）
   - [ ] 单词卡片组件（word-card）
   - [ ] 进度条组件（progress-bar）
   - [ ] 对话框组件（dialogue-box）
   - [ ] 学习统计组件（study-stats）

2. **页面完善**（优先级：高）
   - [ ] 完成复习页面功能
   - [ ] 实现生词本的增删改查
   - [ ] AI语法讲解页面对接GPT
   - [ ] 对话练习页面实现
   - [ ] 个人中心页面完善

3. **数据层实现**（优先级：中）
   - [ ] 设计数据库结构（词条表、用户学习记录表等）
   - [ ] 创建Mock数据服务
   - [ ] 实现本地数据持久化

4. **云开发集成**（优先级：中）
   - [ ] 初始化云开发环境
   - [ ] 部署audio-tts云函数
   - [ ] 创建用户认证云函数
   - [ ] 实现数据同步机制

5. **音频功能完善**（优先级：中）
   - [ ] 收集日语音频资源
   - [ ] 优化TTS效果
   - [ ] 实现音频预加载
   - [ ] 添加发音评分功能

6. **UI/UX优化**（优先级：低）
   - [ ] 设计并添加图标资源
   - [ ] 优化页面过渡动画
   - [ ] 实现手势操作（滑动切换单词）
   - [ ] 添加学习成就动画

7. **测试与优化**（优先级：低）
   - [ ] 编写单元测试
   - [ ] 性能优化（懒加载、分包等）
   - [ ] 兼容性测试（iOS/Android）
   - [ ] 用户体验测试

### 近期重点
1. 首先完成组件库开发，这是其他页面的基础
2. 实现云开发环境，确保数据能够持久化
3. 完善音频播放功能，提升学习体验