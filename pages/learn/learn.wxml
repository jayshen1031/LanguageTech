<view class="container">
  <!-- å­¦ä¹ è®¾ç½®ï¼ˆé¦–æ¬¡åŠ è½½æ—¶æ˜¾ç¤ºï¼‰ -->
  <view class="setup-modal" wx:if="{{showSetup}}">
    <view class="setup-content">
      <text class="setup-title">ä»Šå¤©æƒ³å­¦ä¹ å¤šå°‘ä¸ªå•è¯ï¼Ÿ</text>
      <view class="word-count-options">
        <button class="count-option" bindtap="selectWordCount" data-count="5">5ä¸ª</button>
        <button class="count-option" bindtap="selectWordCount" data-count="10">10ä¸ª</button>
        <button class="count-option" bindtap="selectWordCount" data-count="15">15ä¸ª</button>
        <button class="count-option" bindtap="selectWordCount" data-count="20">20ä¸ª</button>
      </view>
      <text class="setup-tip">å»ºè®®æ¯å¤©å­¦ä¹ 10-15ä¸ªæ–°è¯</text>

      <!-- æ¥æºæ ‡ç­¾ç­›é€‰ -->
      <view class="source-filter" wx:if="{{availableTags.length > 0}}">
        <text class="filter-label">ğŸ“š å­¦ä¹ æ¥æºï¼š</text>
        <scroll-view scroll-x="true" class="tag-scroll">
          <view class="tag-options">
            <view class="tag-option {{selectedTag === '' ? 'active' : ''}}"
                  bindtap="selectSourceTag" data-tag="">
              å…¨éƒ¨æ¥æº
            </view>
            <view wx:for="{{availableTags}}" wx:key="index"
                  class="tag-option {{selectedTag === item ? 'active' : ''}}"
                  bindtap="selectSourceTag" data-tag="{{item}}">
              {{item}}
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- è‡ªåŠ¨å¼€å§‹é€‰é¡¹ -->
      <view class="auto-start-option">
        <switch bindchange="toggleAutoStart" />
        <text>ä¸‹æ¬¡è‡ªåŠ¨å¼€å§‹å­¦ä¹ </text>
      </view>
    </view>
  </view>

  <!-- æ¥æºæ ‡ç­¾ç­›é€‰ï¼ˆä¸»ç•Œé¢ï¼‰ -->
  <view class="main-source-filter" wx:if="{{!showSetup && availableTags.length > 0}}">
    <scroll-view scroll-x="true" class="tag-scroll-main">
      <view class="tag-options-main">
        <view class="tag-option-main {{selectedTag === '' ? 'active' : ''}}"
              bindtap="selectSourceTag" data-tag="">
          å…¨éƒ¨æ¥æº
        </view>
        <view wx:for="{{availableTags}}" wx:key="index"
              class="tag-option-main {{selectedTag === item ? 'active' : ''}}"
              bindtap="selectSourceTag" data-tag="{{item}}">
          {{item}}
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å­¦ä¹ è¿›åº¦ -->
  <view class="progress-header" wx:if="{{!showSetup}}">
    <text class="progress-text">{{currentIndex + 1}} / {{wordList.length}}</text>
    <view class="progress-dots">
      <view
        wx:for="{{wordList}}"
        wx:key="id"
        class="dot {{index <= currentIndex ? 'active' : ''}}"
      ></view>
    </view>
  </view>

  <!-- å•è¯å¡ç‰‡ -->
  <view class="word-card-wrapper">
    <view class="word-card" bindtap="playAudio">
      <view class="word-main">
        <text class="word-text">{{currentWord.word}}</text>
        <view class="word-kana">
          <text class="romaji">{{currentWord.romaji}}</text>
        </view>
      </view>
      
      <view class="divider"></view>
      
      <view class="word-meaning">
        <text class="meaning-text">{{currentWord.meaning}}</text>
        <view class="word-meta">
          <text class="word-type">{{currentWord.type}}</text>
          <text class="word-level">{{currentWord.level}}</text>
          <text class="word-source" wx:if="{{currentWord.source === 'history'}}">è§£æè¯æ±‡</text>
        </view>
      </view>
      
      <!-- ä¾‹å¥éƒ¨åˆ† -->
      <view class="example-section" wx:if="{{currentWord.examples && currentWord.examples.length > 0}}">
        <text class="example-title">ä¾‹å¥ï¼š</text>
        <view class="example-item" wx:for="{{currentWord.examples}}" wx:key="index">
          <text class="example-jp">{{item.jp}}</text>
          <text class="example-romaji" wx:if="{{item.romaji}}">{{item.romaji}}</text>
          <text class="example-cn">{{item.cn}}</text>
          
          <!-- å¥å­ç»“æ„ -->
          <view class="example-structure" wx:if="{{item.structure}}">
            <text class="structure-label">ç»“æ„ï¼š</text>
            <text class="structure-content">{{item.structure}}</text>
          </view>
          
          <!-- è¯­æ³•åˆ†æ -->
          <view class="example-analysis" wx:if="{{item.analysis}}">
            <text class="analysis-label">åˆ†æï¼š</text>
            <text class="analysis-content">{{item.analysis}}</text>
          </view>
          
          <view class="example-source" wx:if="{{item.source}}">
            <text class="source-label">å‡ºå¤„ï¼š{{item.source}}</text>
          </view>
        </view>
        
        <!-- è¯­æ³•ä¿¡æ¯ -->
        <view wx:if="{{currentWord.grammar || currentWord.structure || currentWord.analysis}}" class="grammar-section">
          <view wx:if="{{currentWord.structure}}" class="grammar-item">
            <text class="grammar-label">å¥å­ç»“æ„ï¼š</text>
            <text class="grammar-content">{{currentWord.structure}}</text>
          </view>
          
          <view wx:if="{{currentWord.grammar}}" class="grammar-item">
            <text class="grammar-label">è¯­æ³•è¦ç‚¹ï¼š</text>
            <text class="grammar-content">{{currentWord.grammar}}</text>
          </view>
          
          <view wx:if="{{currentWord.analysis}}" class="grammar-item">
            <text class="grammar-label">è¯¦ç»†è§£æï¼š</text>
            <text class="grammar-content">{{currentWord.analysis}}</text>
          </view>
        </view>
      </view>
      
      <!-- æ— ä¾‹å¥æç¤º -->
      <view class="example-section" wx:if="{{!currentWord.examples || currentWord.examples.length === 0}}">
        <text class="example-title">ä¾‹å¥ï¼š</text>
        <text class="no-example-hint">æš‚æ— ä¾‹å¥</text>
        <view class="add-example-hint">
          <text>ğŸ’¡ å»</text>
          <text class="link-text" bindtap="goToParser">æ—¥è¯­è§£æ</text>
          <text>é¡µé¢è¾“å…¥åŒ…å«æ­¤è¯çš„å¥å­ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å…³è”ä¾‹å¥</text>
        </view>
      </view>
      
      <view class="audio-hint">
        <text>ğŸ”Š ç‚¹å‡»å¡ç‰‡æ’­æ”¾è¯­éŸ³</text>
      </view>
    </view>
  </view>

  <!-- ç¿»é¡µæŒ‰é’® -->
  <view class="nav-buttons">
    <button class="btn-nav" bindtap="prevWord" disabled="{{currentIndex === 0}}">
      ä¸Šä¸€ä¸ª
    </button>
    <button class="btn-nav" bindtap="nextWord" disabled="{{currentIndex >= wordList.length - 1}}">
      ä¸‹ä¸€ä¸ª
    </button>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn-action" bindtap="toggleExample">
      {{showExample ? 'éšè—ä¾‹å¥' : 'æ˜¾ç¤ºä¾‹å¥'}}
    </button>
  </view>

  <!-- å­¦ä¹ è¿›åº¦å’Œç¡®è®¤æŒ‰é’® -->
  <view class="learning-progress-section">
    <!-- å­¦ä¹ è¿›åº¦æ˜¾ç¤º -->
    <view class="learning-stats">
      <view class="stat-item">
        <text class="stat-icon">ğŸ“š</text>
        <text class="stat-text">æœ¬è½®å­¦ä¹  {{currentWord.sessionCount || 0}} æ¬¡</text>
      </view>
      <view class="stat-item">
        <text class="stat-icon">âœ…</text>
        <text class="stat-text">ç´¯è®¡å­¦ä¹  {{currentWord.learningCount || 0}} æ¬¡</text>
      </view>
    </view>

    <!-- å­¦ä¹ æ“ä½œæŒ‰é’® -->
    <view class="learning-action-buttons">
      <!-- æœªæŒæ¡æ—¶æ˜¾ç¤ºå­¦ä¹ æŒ‰é’® -->
      <block wx:if="{{!currentWord.masteryConfirmed}}">
        <button class="btn-continue" bindtap="continueLearning">
          <text class="btn-icon">â•</text>
          <text>+1å­¦ä¹ </text>
        </button>
        <button
          class="btn-confirm-master {{canConfirmMastery ? 'active' : 'disabled'}}"
          bindtap="confirmMastery"
          disabled="{{!canConfirmMastery}}">
          <text class="btn-icon">{{canConfirmMastery ? 'ğŸ¯' : 'ğŸ”’'}}</text>
          <text>{{canConfirmMastery ? 'ç¡®è®¤å·²æŒæ¡' : 'éœ€å­¦ä¹ ' + requiredLearningCount + 'æ¬¡'}}</text>
        </button>
      </block>

      <!-- å·²æŒæ¡æ—¶æ˜¾ç¤ºçŠ¶æ€ -->
      <view class="mastered-container" wx:else>
        <view class="mastered-status">
          <text class="mastered-icon">âœ…</text>
          <text class="mastered-text">å·²æŒæ¡æ­¤å•è¯</text>
          <text class="mastered-count">ï¼ˆç´¯è®¡å­¦ä¹  {{currentWord.learningCount || 0}} æ¬¡ï¼‰</text>
        </view>
        <button class="btn-reset-mastery" bindtap="resetMastery">
          <text class="btn-icon">ğŸ”„</text>
          <text>é‡ç½®ä¸ºæœªæŒæ¡</text>
        </button>
      </view>
    </view>
  </view>

  <!-- å®Œæˆæç¤º -->
  <view class="complete-modal" wx:if="{{showComplete}}">
    <view class="modal-content">
      <text class="complete-title">ğŸ‰ æœ¬è½®å­¦ä¹ å®Œæˆï¼</text>
      <text class="complete-desc">ä½ å·²å­¦ä¹ äº† {{wordList.length}} ä¸ªå•è¯</text>
      <view class="complete-stats">
        <view class="stat-item">
          <text class="stat-label">å­¦ä¹ æ¬¡æ•°</text>
          <text class="stat-value">{{totalLearningCount}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">ç¡®è®¤æŒæ¡</text>
          <text class="stat-value">{{masteredCount}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">å¾…å¤ä¹ </text>
          <text class="stat-value">{{wordList.length - masteredCount}}</text>
        </view>
      </view>
      <view class="complete-buttons">
        <button class="btn-secondary" bindtap="learnMore">ç»§ç»­å­¦ä¹ </button>
        <button class="btn-primary" bindtap="goBack">ç»“æŸå­¦ä¹ </button>
      </view>
    </view>
  </view>
</view>