<!-- pages/mastery-stats/mastery-stats.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="header-left" bindtap="onBack">
      <text class="back-btn">â†</text>
    </view>
    <view class="header-title">å­¦ä¹ ç»Ÿè®¡</view>
    <view class="header-right"></view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">ç»Ÿè®¡è®¡ç®—ä¸­...</text>
  </view>

  <!-- ç»Ÿè®¡å†…å®¹ -->
  <view wx:else class="stats-content">
    <!-- ç­›é€‰æ  -->
    <view class="filter-bar">
      <view class="filter-item {{filterType === 'all' ? 'active' : ''}}" bindtap="onFilterChange" data-type="all">
        å…¨éƒ¨è®°å½•
      </view>
      <view class="filter-item {{filterType === 'favorite' ? 'active' : ''}}" bindtap="onFilterChange" data-type="favorite">
        æ”¶è—è®°å½•
      </view>
      <view class="filter-item {{filterType === 'recent' ? 'active' : ''}}" bindtap="onFilterChange" data-type="recent">
        æœ€è¿‘7å¤©
      </view>
    </view>

    <!-- æ€»ä½“æ¦‚è§ˆ -->
    <view class="overview-card">
      <view class="overview-title">ğŸ“Š æ€»ä½“æŒæ¡æƒ…å†µ</view>
      <view class="overview-grid">
        <view class="overview-item">
          <text class="overview-number">{{totalStats.sentence.total}}</text>
          <text class="overview-label">å¥å­æ€»æ•°</text>
        </view>
        <view class="overview-item">
          <text class="overview-number">{{totalStats.word.total}}</text>
          <text class="overview-label">è¯æ±‡æ€»æ•°</text>
        </view>
        <view class="overview-item">
          <text class="overview-number">{{totalStats.analysis.total}}</text>
          <text class="overview-label">è¯­æ³•ç‚¹æ€»æ•°</text>
        </view>
        <view class="overview-item">
          <text class="overview-number">{{totalStats.sentence.mastered + totalStats.word.mastered + totalStats.analysis.mastered}}</text>
          <text class="overview-label">å·²æŒæ¡é¡¹ç›®</text>
        </view>
      </view>
    </view>

    <!-- åˆ†ç±»ç»Ÿè®¡ -->
    <view class="category-stats">
      <!-- å¥å­æŒæ¡åº¦ -->
      <view class="stat-card">
        <view class="stat-header">
          <text class="stat-title">ğŸ“ å¥å­æŒæ¡æƒ…å†µ</text>
          <text class="stat-total">({{totalStats.sentence.total}}ä¸ª)</text>
        </view>
        <view class="stat-bar">
          <view class="bar-segment mastered" style="width: {{totalStats.sentence.masteredPercent}}%"></view>
          <view class="bar-segment partial" style="width: {{totalStats.sentence.partialPercent}}%"></view>
          <view class="bar-segment unfamiliar" style="width: {{totalStats.sentence.unfamiliarPercent}}%"></view>
          <view class="bar-segment unseen" style="width: {{totalStats.sentence.unseenPercent}}%"></view>
        </view>
        <view class="stat-legend">
          <view class="legend-item mastered">
            <view class="legend-dot"></view>
            <text>å·²æŒæ¡ {{totalStats.sentence.mastered}}</text>
          </view>
          <view class="legend-item partial">
            <view class="legend-dot"></view>
            <text>ç•¥æ‡‚ {{totalStats.sentence.partial}}</text>
          </view>
          <view class="legend-item unfamiliar">
            <view class="legend-dot"></view>
            <text>æœªæŒæ¡ {{totalStats.sentence.unfamiliar}}</text>
          </view>
          <view class="legend-item unseen">
            <view class="legend-dot"></view>
            <text>æœªçœ‹ {{totalStats.sentence.unseen}}</text>
          </view>
        </view>
      </view>

      <!-- è¯æ±‡æŒæ¡åº¦ -->
      <view class="stat-card">
        <view class="stat-header">
          <text class="stat-title">ğŸ“š è¯æ±‡æŒæ¡æƒ…å†µ</text>
          <text class="stat-total">({{totalStats.word.total}}ä¸ª)</text>
        </view>
        <view class="stat-bar">
          <view class="bar-segment mastered" style="width: {{totalStats.word.masteredPercent}}%"></view>
          <view class="bar-segment partial" style="width: {{totalStats.word.partialPercent}}%"></view>
          <view class="bar-segment unfamiliar" style="width: {{totalStats.word.unfamiliarPercent}}%"></view>
          <view class="bar-segment unseen" style="width: {{totalStats.word.unseenPercent}}%"></view>
        </view>
        <view class="stat-legend">
          <view class="legend-item mastered">
            <view class="legend-dot"></view>
            <text>å·²æŒæ¡ {{totalStats.word.mastered}}</text>
          </view>
          <view class="legend-item partial">
            <view class="legend-dot"></view>
            <text>ç•¥æ‡‚ {{totalStats.word.partial}}</text>
          </view>
          <view class="legend-item unfamiliar">
            <view class="legend-dot"></view>
            <text>æœªæŒæ¡ {{totalStats.word.unfamiliar}}</text>
          </view>
          <view class="legend-item unseen">
            <view class="legend-dot"></view>
            <text>æœªçœ‹ {{totalStats.word.unseen}}</text>
          </view>
        </view>
      </view>

      <!-- è¯­æ³•åˆ†ææŒæ¡åº¦ -->
      <view class="stat-card">
        <view class="stat-header">
          <text class="stat-title">ğŸ” è¯­æ³•åˆ†ææŒæ¡æƒ…å†µ</text>
          <text class="stat-total">({{totalStats.analysis.total}}ä¸ª)</text>
        </view>
        <view class="stat-bar">
          <view class="bar-segment mastered" style="width: {{totalStats.analysis.masteredPercent}}%"></view>
          <view class="bar-segment partial" style="width: {{totalStats.analysis.partialPercent}}%"></view>
          <view class="bar-segment unfamiliar" style="width: {{totalStats.analysis.unfamiliarPercent}}%"></view>
          <view class="bar-segment unseen" style="width: {{totalStats.analysis.unseenPercent}}%"></view>
        </view>
        <view class="stat-legend">
          <view class="legend-item mastered">
            <view class="legend-dot"></view>
            <text>å·²æŒæ¡ {{totalStats.analysis.mastered}}</text>
          </view>
          <view class="legend-item partial">
            <view class="legend-dot"></view>
            <text>ç•¥æ‡‚ {{totalStats.analysis.partial}}</text>
          </view>
          <view class="legend-item unfamiliar">
            <view class="legend-dot"></view>
            <text>æœªæŒæ¡ {{totalStats.analysis.unfamiliar}}</text>
          </view>
          <view class="legend-item unseen">
            <view class="legend-dot"></view>
            <text>æœªçœ‹ {{totalStats.analysis.unseen}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å­¦ä¹ å»ºè®® -->
    <view class="suggestion-card">
      <view class="suggestion-title">ğŸ’¡ å­¦ä¹ å»ºè®®</view>
      <view class="suggestion-content">
        <view wx:if="{{totalStats.sentence.unfamiliar > 0}}" class="suggestion-item">
          <text class="suggestion-icon">ğŸ“</text>
          <text class="suggestion-text">è¿˜æœ‰ {{totalStats.sentence.unfamiliar}} ä¸ªå¥å­éœ€è¦é‡ç‚¹å­¦ä¹ </text>
        </view>
        <view wx:if="{{totalStats.word.unfamiliar > 0}}" class="suggestion-item">
          <text class="suggestion-icon">ğŸ“š</text>
          <text class="suggestion-text">è¿˜æœ‰ {{totalStats.word.unfamiliar}} ä¸ªè¯æ±‡éœ€è¦åŠ å¼ºè®°å¿†</text>
        </view>
        <view wx:if="{{totalStats.analysis.unfamiliar > 0}}" class="suggestion-item">
          <text class="suggestion-icon">ğŸ”</text>
          <text class="suggestion-text">è¿˜æœ‰ {{totalStats.analysis.unfamiliar}} ä¸ªè¯­æ³•ç‚¹éœ€è¦æ·±å…¥ç†è§£</text>
        </view>
        <view wx:if="{{totalStats.sentence.partial + totalStats.word.partial + totalStats.analysis.partial > 0}}" class="suggestion-item">
          <text class="suggestion-icon">ğŸ“–</text>
          <text class="suggestion-text">å»ºè®®å¤šå¤ä¹ "ç•¥æ‡‚"çš„å†…å®¹ï¼Œå·©å›ºè®°å¿†</text>
        </view>
        <view wx:if="{{totalStats.sentence.mastered === totalStats.sentence.total && totalStats.word.mastered === totalStats.word.total && totalStats.analysis.mastered === totalStats.analysis.total}}" class="suggestion-item success">
          <text class="suggestion-icon">ğŸ‰</text>
          <text class="suggestion-text">æ­å–œï¼æ‚¨å·²ç»æŒæ¡äº†æ‰€æœ‰å†…å®¹</text>
        </view>
      </view>
    </view>

    <!-- è¿›åº¦ç¯å½¢å›¾ -->
    <view class="progress-circle-card">
      <view class="progress-title">ğŸ¯ æ€»ä½“è¿›åº¦</view>
      <view class="progress-circle">
        <view class="circle-bg"></view>
        <view class="circle-progress" style="stroke-dasharray: {{(totalStats.sentence.mastered + totalStats.word.mastered + totalStats.analysis.mastered) / (totalStats.sentence.total + totalStats.word.total + totalStats.analysis.total) * 314}}, 314"></view>
        <view class="circle-text">
          <text class="progress-percent">{{Math.round((totalStats.sentence.mastered + totalStats.word.mastered + totalStats.analysis.mastered) / (totalStats.sentence.total + totalStats.word.total + totalStats.analysis.total) * 100) || 0}}%</text>
          <text class="progress-label">å·²æŒæ¡</text>
        </view>
      </view>
    </view>
  </view>
</view>