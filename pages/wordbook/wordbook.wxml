<view class="wordbook-container">
  <!-- 顶部标题栏 -->
  <view class="header">
    <view class="title-section">
      <text class="page-title">JLPT N2 生词本</text>
      <text class="word-count">共 {{totalCount}} 个词汇</text>
    </view>
    
    <!-- 视图切换 -->
    <view class="view-tabs">
      <view class="tab {{viewMode === 'all' ? 'active' : ''}}" 
            bindtap="onViewModeChange" data-mode="all">
        全部词汇
      </view>
      <view class="tab {{viewMode === 'favorite' ? 'active' : ''}}" 
            bindtap="onViewModeChange" data-mode="favorite">
        我的收藏
      </view>
      <view class="tab {{viewMode === 'learned' ? 'active' : ''}}" 
            bindtap="onViewModeChange" data-mode="learned">
        已学习
      </view>
    </view>
  </view>

  <!-- 搜索和筛选栏 -->
  <view class="filter-bar">
    <view class="search-box">
      <input class="search-input" 
             placeholder="搜索日语、假名或中文含义" 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             bindconfirm="onSearch" />
      <button class="search-btn" bindtap="onSearch">搜索</button>
    </view>
    
    <view class="filter-options">
      <picker bindchange="onCategoryChange" value="0" range="{{categories}}">
        <view class="filter-item">
          <text>分类：{{selectedCategory}}</text>
          <text class="arrow">▼</text>
        </view>
      </picker>
      
      <picker bindchange="onSortChange" value="0" range="{{['默认排序', '按频率', '随机']}}">
        <view class="filter-item">
          <text>排序：{{sortBy === 'frequency' ? '按频率' : sortBy === 'random' ? '随机' : '默认'}}</text>
          <text class="arrow">▼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- 导入进度条 -->
  <view class="import-progress" wx:if="{{isImporting}}">
    <text class="progress-text">正在导入词汇...</text>
    <progress percent="{{importProgress}}" stroke-width="3" activeColor="#4CAF50" />
  </view>

  <!-- 词汇列表 -->
  <scroll-view class="word-list" scroll-y>
    <block wx:for="{{vocabulary}}" wx:key="_id">
      <view class="word-card" bindtap="showWordDetail" data-word="{{item}}">
        <view class="word-main">
          <view class="word-header">
            <text class="word-text">{{item.word}}</text>
            <view class="word-badges">
              <text class="badge learned" wx:if="{{item.isLearned}}">已学</text>
              <text class="badge favorite" wx:if="{{item.isFavorite}}">★</text>
              <text class="badge frequency">频率{{item.frequency || 1}}</text>
            </view>
          </view>
          
          <view class="word-info">
            <text class="reading">{{item.reading}}</text>
            <text class="meaning">{{item.displayMeaning}}</text>
          </view>
          
          <view class="word-meta">
            <text class="part-of-speech">{{item.partOfSpeech[0] || ''}}</text>
            <text class="category">{{item.category}}</text>
          </view>
          
          <view class="word-example" wx:if="{{item.examples && item.examples[0]}}">
            <text class="example-text">例：{{item.examples[0]}}</text>
          </view>
        </view>
        
        <view class="word-actions" catchtap="stopPropagation">
          <button class="action-btn" catchtap="playAudio" data-word="{{item}}">
            <text>🔊</text>
          </button>
          <button class="action-btn" catchtap="toggleFavorite" data-word="{{item}}">
            <text>{{item.isFavorite ? '❤️' : '🤍'}}</text>
          </button>
          <button class="action-btn" catchtap="addToStudyPlan" data-word="{{item}}">
            <text>📚</text>
          </button>
        </view>
      </view>
    </block>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{vocabulary.length === 0 && !loading}}">
      <image src="/images/empty.png" class="empty-icon" />
      <text class="empty-text">暂无词汇数据</text>
      <button class="import-btn" bindtap="importN2Vocabulary" wx:if="{{!isImporting}}">
        导入N2词汇库
      </button>
    </view>
  </scroll-view>

  <!-- 分页控制 -->
  <view class="pagination" wx:if="{{totalPages > 1}}">
    <button class="page-btn" bindtap="onPrevPage" disabled="{{currentPage === 1}}">
      上一页
    </button>
    <text class="page-info">{{currentPage}} / {{totalPages}}</text>
    <button class="page-btn" bindtap="onNextPage" disabled="{{currentPage === totalPages}}">
      下一页
    </button>
  </view>

  <!-- 词汇详情弹窗 -->
  <view class="modal-overlay" wx:if="{{showDetail}}" bindtap="hideWordDetail">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{currentWord.word}}</text>
        <text class="close-btn" bindtap="hideWordDetail">✕</text>
      </view>
      
      <view class="modal-body">
        <view class="detail-section">
          <text class="detail-label">假名：</text>
          <text class="detail-value">{{currentWord.reading}}</text>
        </view>
        
        <view class="detail-section">
          <text class="detail-label">含义：</text>
          <view class="meanings-list">
            <text class="meaning-item" wx:for="{{currentWord.meanings}}" wx:key="*this">
              {{index + 1}}. {{item}}
            </text>
          </view>
        </view>
        
        <view class="detail-section">
          <text class="detail-label">词性：</text>
          <view class="pos-tags">
            <text class="pos-tag" wx:for="{{currentWord.partOfSpeech}}" wx:key="*this">
              {{item}}
            </text>
          </view>
        </view>
        
        <view class="detail-section" wx:if="{{currentWord.examples && currentWord.examples.length > 0}}">
          <text class="detail-label">例句：</text>
          <view class="examples-list">
            <view class="example-item" wx:for="{{currentWord.examples}}" wx:key="*this">
              <text class="example-jp">{{item}}</text>
            </view>
          </view>
        </view>
        
        <view class="detail-actions">
          <button class="detail-btn primary" catchtap="playAudio" data-word="{{currentWord}}">
            播放发音
          </button>
          <button class="detail-btn" catchtap="markAsLearned" data-word="{{currentWord}}">
            标记已学
          </button>
          <button class="detail-btn" catchtap="toggleFavorite" data-word="{{currentWord}}">
            {{currentWord.isFavorite ? '取消收藏' : '收藏'}}
          </button>
        </view>
      </view>
    </view>
  </view>
</view>