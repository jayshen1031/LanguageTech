<view class="wordbook-container">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <view class="title-section">
      <text class="page-title">JLPT N2 ç”Ÿè¯æœ¬</text>
      <text class="word-count">å…± {{totalCount}} ä¸ªè¯æ±‡</text>
    </view>
    
    <!-- è§†å›¾åˆ‡æ¢ -->
    <view class="view-tabs">
      <view class="tab {{viewMode === 'all' ? 'active' : ''}}" 
            bindtap="onViewModeChange" data-mode="all">
        å…¨éƒ¨è¯æ±‡
      </view>
      <view class="tab {{viewMode === 'favorite' ? 'active' : ''}}" 
            bindtap="onViewModeChange" data-mode="favorite">
        æˆ‘çš„æ”¶è—
      </view>
      <view class="tab {{viewMode === 'learned' ? 'active' : ''}}" 
            bindtap="onViewModeChange" data-mode="learned">
        å·²å­¦ä¹ 
      </view>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="search-box">
      <input class="search-input" 
             placeholder="æœç´¢æ—¥è¯­ã€å‡åæˆ–ä¸­æ–‡å«ä¹‰" 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             bindconfirm="onSearch" />
      <button class="search-btn" bindtap="onSearch">æœç´¢</button>
    </view>
    
    <view class="filter-options">
      <picker bindchange="onCategoryChange" value="0" range="{{categories}}">
        <view class="filter-item">
          <text>åˆ†ç±»ï¼š{{selectedCategory}}</text>
          <text class="arrow">â–¼</text>
        </view>
      </picker>
      
      <picker bindchange="onSortChange" value="0" range="{{['é»˜è®¤æ’åº', 'æŒ‰é¢‘ç‡', 'éšæœº']}}">
        <view class="filter-item">
          <text>æ’åºï¼š{{sortBy === 'frequency' ? 'æŒ‰é¢‘ç‡' : sortBy === 'random' ? 'éšæœº' : 'é»˜è®¤'}}</text>
          <text class="arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- å¯¼å…¥è¿›åº¦æ¡ -->
  <view class="import-progress" wx:if="{{isImporting}}">
    <text class="progress-text">æ­£åœ¨å¯¼å…¥è¯æ±‡...</text>
    <progress percent="{{importProgress}}" stroke-width="3" activeColor="#4CAF50" />
  </view>

  <!-- è¯æ±‡åˆ—è¡¨ -->
  <scroll-view class="word-list" scroll-y>
    <block wx:for="{{vocabulary}}" wx:key="_id">
      <view class="word-card" bindtap="showWordDetail" data-word="{{item}}">
        <view class="word-main">
          <view class="word-header">
            <text class="word-text">{{item.word}}</text>
            <view class="word-badges">
              <text class="badge learned" wx:if="{{item.isLearned}}">å·²å­¦</text>
              <text class="badge favorite" wx:if="{{item.isFavorite}}">â˜…</text>
              <text class="badge frequency">é¢‘ç‡{{item.frequency || 1}}</text>
            </view>
          </view>
          
          <view class="word-info">
            <text class="reading">{{item.reading}}</text>
            <text class="meaning">{{item.displayMeaning}}</text>
          </view>
          
          <view class="word-meta">
            <text class="part-of-speech">{{item.partOfSpeech[0] || ''}}</text>
            <text class="category">{{item.category}}</text>
          </view>
          
          <view class="word-example" wx:if="{{item.examples && item.examples[0]}}">
            <text class="example-text">ä¾‹ï¼š{{item.examples[0]}}</text>
          </view>
        </view>
        
        <view class="word-actions" catchtap="stopPropagation">
          <button class="action-btn" catchtap="playAudio" data-word="{{item}}">
            <text>ğŸ”Š</text>
          </button>
          <button class="action-btn" catchtap="toggleFavorite" data-word="{{item}}">
            <text>{{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          </button>
          <button class="action-btn" catchtap="addToStudyPlan" data-word="{{item}}">
            <text>ğŸ“š</text>
          </button>
        </view>
      </view>
    </block>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{vocabulary.length === 0 && !loading}}">
      <image src="/images/empty.png" class="empty-icon" />
      <text class="empty-text">æš‚æ— è¯æ±‡æ•°æ®</text>
      <button class="import-btn" bindtap="importN2Vocabulary" wx:if="{{!isImporting}}">
        å¯¼å…¥N2è¯æ±‡åº“
      </button>
    </view>
  </scroll-view>

  <!-- åˆ†é¡µæ§åˆ¶ -->
  <view class="pagination" wx:if="{{totalPages > 1}}">
    <button class="page-btn" bindtap="onPrevPage" disabled="{{currentPage === 1}}">
      ä¸Šä¸€é¡µ
    </button>
    <text class="page-info">{{currentPage}} / {{totalPages}}</text>
    <button class="page-btn" bindtap="onNextPage" disabled="{{currentPage === totalPages}}">
      ä¸‹ä¸€é¡µ
    </button>
  </view>

  <!-- è¯æ±‡è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showDetail}}" bindtap="hideWordDetail">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{currentWord.word}}</text>
        <text class="close-btn" bindtap="hideWordDetail">âœ•</text>
      </view>
      
      <view class="modal-body">
        <view class="detail-section">
          <text class="detail-label">å‡åï¼š</text>
          <text class="detail-value">{{currentWord.reading}}</text>
        </view>
        
        <view class="detail-section">
          <text class="detail-label">å«ä¹‰ï¼š</text>
          <view class="meanings-list">
            <text class="meaning-item" wx:for="{{currentWord.meanings}}" wx:key="*this">
              {{index + 1}}. {{item}}
            </text>
          </view>
        </view>
        
        <view class="detail-section">
          <text class="detail-label">è¯æ€§ï¼š</text>
          <view class="pos-tags">
            <text class="pos-tag" wx:for="{{currentWord.partOfSpeech}}" wx:key="*this">
              {{item}}
            </text>
          </view>
        </view>
        
        <view class="detail-section" wx:if="{{currentWord.examples && currentWord.examples.length > 0}}">
          <text class="detail-label">ä¾‹å¥ï¼š</text>
          <view class="examples-list">
            <view class="example-item" wx:for="{{currentWord.examples}}" wx:key="*this">
              <text class="example-jp">{{item}}</text>
            </view>
          </view>
        </view>
        
        <view class="detail-actions">
          <button class="detail-btn primary" catchtap="playAudio" data-word="{{currentWord}}">
            æ’­æ”¾å‘éŸ³
          </button>
          <button class="detail-btn" catchtap="markAsLearned" data-word="{{currentWord}}">
            æ ‡è®°å·²å­¦
          </button>
          <button class="detail-btn" catchtap="toggleFavorite" data-word="{{currentWord}}">
            {{currentWord.isFavorite ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—'}}
          </button>
        </view>
      </view>
    </view>
  </view>
</view>