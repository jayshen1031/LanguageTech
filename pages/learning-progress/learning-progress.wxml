<view class="container">
  <!-- è®¤è¯æ£€æŸ¥ -->
  <view wx:if="{{!isAuthenticated}}" class="auth-required">
    <view class="auth-icon">ğŸ”</view>
    <text class="auth-text">éœ€è¦ç™»å½•æŸ¥çœ‹å­¦ä¹ è¿›åº¦</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else>
    <!-- é¡¶éƒ¨æ€»è§ˆ -->
    <view class="header-overview">
      <view class="overview-stats">
        <view class="stat-item">
          <text class="stat-number">{{totalStudyDays}}</text>
          <text class="stat-label">å­¦ä¹ å¤©æ•°</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item highlight">
          <text class="stat-number">{{consecutiveDays}}</text>
          <text class="stat-label">è¿ç»­å¤©æ•°</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{todayProgress.parsed}}</text>
          <text class="stat-label">ä»Šæ—¥è§£æ</text>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥è¿›åº¦å¡ç‰‡ -->
    <view class="today-progress">
      <view class="card-header">
        <text class="card-title">ä»Šæ—¥å­¦ä¹ è¿›åº¦</text>
        <text class="card-date">{{todayProgress.parsed > 0 ? 'æ´»è·ƒä¸­' : 'å¾…å¼€å§‹'}}</text>
      </view>
      <view class="progress-grid">
        <view class="progress-item">
          <text class="progress-icon">ğŸ“</text>
          <view class="progress-content">
            <text class="progress-number">{{todayProgress.parsed}}</text>
            <text class="progress-label">å†…å®¹è§£æ</text>
          </view>
        </view>
        <view class="progress-item">
          <text class="progress-icon">ğŸ“š</text>
          <view class="progress-content">
            <text class="progress-number">{{todayProgress.newWords}}</text>
            <text class="progress-label">æ–°å¢è¯æ±‡</text>
          </view>
        </view>
        <view class="progress-item">
          <text class="progress-icon">ğŸ§ </text>
          <view class="progress-content">
            <text class="progress-number">{{todayProgress.structures}}</text>
            <text class="progress-label">å¥å­ç»“æ„</text>
          </view>
        </view>
        <view class="progress-item">
          <text class="progress-icon">ğŸ”„</text>
          <view class="progress-content">
            <text class="progress-number">{{todayProgress.reviewed}}</text>
            <text class="progress-label">å¤ä¹ æ¬¡æ•°</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
    <view class="tab-bar">
      <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-tab="0">
        <text class="tab-text">å­¦ä¹ è½¨è¿¹</text>
      </view>
      <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-tab="1">
        <text class="tab-text">æ•°æ®ç»Ÿè®¡</text>
      </view>
      <view class="tab-item {{currentTab === 2 ? 'active' : ''}}" bindtap="switchTab" data-tab="2">
        <text class="tab-text">æˆå°±å¾½ç« </text>
      </view>
    </view>

    <!-- å­¦ä¹ è½¨è¿¹ -->
    <view wx:if="{{currentTab === 0}}" class="timeline-container">
      <view wx:if="{{learningTimeline.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">è¿˜æ²¡æœ‰å­¦ä¹ è®°å½•</text>
        <text class="empty-desc">å»è§£æä¸€äº›å†…å®¹å¼€å§‹ä½ çš„å­¦ä¹ ä¹‹æ—…</text>
      </view>
      
      <view wx:else class="timeline">
        <view wx:for="{{learningTimeline}}" wx:key="date" class="timeline-day">
          <view class="day-header" bindtap="toggleDetail" data-index="{{index}}">
            <view class="day-info">
              <text class="day-date">{{item.displayDate}}</text>
              <text class="day-summary">{{item.parseCount}}æ¬¡è§£æ Â· {{item.wordCount}}ä¸ªè¯æ±‡</text>
            </view>
            <text class="expand-icon">{{showDetail[index] ? 'â–¼' : 'â–¶'}}</text>
          </view>
          
          <view wx:if="{{showDetail[index]}}" class="day-activities">
            <view wx:for="{{item.activities}}" wx:for-item="activity" wx:key="time" class="activity-item">
              <view class="activity-time">{{activity.time}}</view>
              <view class="activity-content">
                <view class="activity-header">
                  <text class="activity-type-icon">
                    {{activity.type === 'parse' ? 'ğŸ“' : activity.type === 'learn' ? 'ğŸ“š' : 'ğŸ”„'}}
                  </text>
                  <text class="activity-title">{{activity.title}}</text>
                </view>
                <text class="activity-desc">{{activity.content}}</text>
                <text wx:if="{{activity.wordCount > 0}}" class="activity-words">+{{activity.wordCount}}ä¸ªè¯æ±‡</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ•°æ®ç»Ÿè®¡ -->
    <view wx:if="{{currentTab === 1}}" class="stats-container">
      <!-- æœ¬å‘¨æ´»è·ƒåº¦ -->
      <view class="stats-card">
        <text class="stats-title">æœ¬å‘¨å­¦ä¹ æ´»è·ƒåº¦</text>
        <view class="week-chart">
          <view wx:for="{{weeklyStats}}" wx:key="date" class="week-day">
            <view class="day-bar">
              <view class="bar {{item.active ? 'active' : ''}}" style="height: {{item.barHeight}}px"></view>
            </view>
            <text class="day-label">{{item.date}}</text>
          </view>
        </view>
        <view class="week-summary">
          <text class="summary-text">æœ¬å‘¨å…±å­¦ä¹  {{weekTotalCount}} æ¬¡</text>
        </view>
      </view>

      <!-- å­¦ä¹ åˆ†å¸ƒ -->
      <view class="stats-card">
        <text class="stats-title">å­¦ä¹ å†…å®¹åˆ†å¸ƒ</text>
        <view class="distribution-stats">
          <view class="dist-item">
            <view class="dist-icon">ğŸ“</view>
            <view class="dist-info">
              <text class="dist-label">å†…å®¹è§£æ</text>
              <text class="dist-value">{{totalParseCount}}æ¬¡</text>
            </view>
          </view>
          <view class="dist-item">
            <view class="dist-icon">ğŸ“š</view>
            <view class="dist-info">
              <text class="dist-label">è¯æ±‡æ”¶é›†</text>
              <text class="dist-value">{{totalWordCount}}ä¸ª</text>
            </view>
          </view>
          <view class="dist-item">
            <view class="dist-icon">ğŸ§ </view>
            <view class="dist-info">
              <text class="dist-label">å¥å­ç»“æ„</text>
              <text class="dist-value">{{totalStructureCount}}ä¸ª</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æˆå°±å¾½ç«  -->
    <view wx:if="{{currentTab === 2}}" class="achievements-container">
      <view wx:if="{{achievements.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ†</text>
        <text class="empty-text">æš‚æ— æˆå°±</text>
        <text class="empty-desc">ç»§ç»­å­¦ä¹ è§£é”æ›´å¤šæˆå°±</text>
      </view>
      
      <view wx:else class="achievements-grid">
        <view wx:for="{{achievements}}" wx:key="id" class="achievement-card {{item.unlocked ? 'unlocked' : 'locked'}}">
          <view class="achievement-icon">{{item.icon}}</view>
          <text class="achievement-title">{{item.title}}</text>
          <text class="achievement-desc">{{item.description}}</text>
          <view class="achievement-progress">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.progress}}%"></view>
            </view>
            <text class="progress-text">{{item.progressText}}%</text>
          </view>
          <view wx:if="{{item.unlocked}}" class="unlocked-badge">âœ“</view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-overlay">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½å­¦ä¹ æ•°æ®ä¸­...</text>
    </view>
  </view>
</view>