<!-- pages/parser-history/parser-history.wxml -->
<view class="container">
  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="filter-item {{filterType === 'all' ? 'active' : ''}}" bindtap="onFilterChange" data-type="all">
      å…¨éƒ¨
    </view>
    <view class="filter-item {{filterType === 'favorite' ? 'active' : ''}}" bindtap="onFilterChange" data-type="favorite">
      æ”¶è—
    </view>
    <view class="filter-item {{filterType === 'recent' ? 'active' : ''}}" bindtap="onFilterChange" data-type="recent">
      æœ€è¿‘ä½¿ç”¨
    </view>
  </view>

  <!-- åŠŸèƒ½æŒ‰é’®æ  -->
  <view class="function-bar">
    <button class="btn-function" bindtap="extractVocabulary">
      <text class="function-icon">ğŸ“š</text>
      <text>æå–è¯æ±‡</text>
    </button>
    <button class="btn-function primary" bindtap="onViewMasteryStats">
      <text class="function-icon">ğŸ“Š</text>
      <text>å­¦ä¹ ç»Ÿè®¡</text>
    </button>
  </view>

  <!-- å†å²åˆ—è¡¨ -->
  <view class="history-list" wx:if="{{historyList.length > 0}}">
    <view class="history-item" wx:for="{{historyList}}" wx:key="_id">
      <view class="item-header">
        <view class="item-time">{{item.displayTime}}</view>
        <view class="item-actions">
          <view class="action-btn" catchtap="onToggleFavorite" data-index="{{index}}">
            <image src="/images/{{item.favorite ? 'star-filled' : 'star'}}.png" class="action-icon"></image>
          </view>
          <view class="action-btn delete-btn" catchtap="onDelete" data-index="{{index}}">
            <text class="delete-text">åˆ é™¤</text>
          </view>
        </view>
      </view>
      
      <view class="item-content" bindtap="onViewDetail" data-item="{{item}}">
        <!-- æ ‡é¢˜è¡Œï¼ˆæœ‰æ ‡é¢˜æ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{item.articleTitle || item.title}}" class="item-title">
          <text class="title-text">{{item.articleTitle || item.title}}</text>
          <text class="edit-title-btn" catchtap="onEditTitle" data-index="{{index}}">âœï¸</text>
        </view>
        <!-- æ·»åŠ æ ‡é¢˜æŒ‰é’®ï¼ˆæ²¡æœ‰æ ‡é¢˜æ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:else class="add-title-row">
          <text class="add-title-btn" catchtap="onAddTitle" data-index="{{index}}">+ æ·»åŠ æ ‡é¢˜</text>
        </view>
        <!-- é¢„è§ˆå†…å®¹ -->
        <view class="item-preview">{{item.preview}}</view>
        <view class="item-info">
          <text class="info-tag">{{item.inputMethod === 'image' ? 'å›¾ç‰‡' : 'æ–‡æœ¬'}}</text>
          <text class="info-count" wx:if="{{item.sentences}}">{{item.sentences.length}}ä¸ªå¥å­</text>

          <!-- åˆ†ç±»æ ‡ç­¾åŒºåŸŸ -->
          <view class="category-section">
            <view wx:if="{{item.categoryTag}}" class="category-badge-container">
              <text class="category-badge">{{item.categoryTag}}</text>
              <text class="edit-category-btn" catchtap="onEditCategory" data-index="{{index}}">âœï¸</text>
            </view>
            <text wx:else class="add-category-btn" catchtap="onAddCategory" data-index="{{index}}">+ æ·»åŠ æ ‡ç­¾</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && historyList.length === 0}}">
    <image src="/images/empty.png" class="empty-image"></image>
    <text class="empty-text">æš‚æ— è§£æè®°å½•</text>
    <view class="empty-button" bindtap="onGoToParser">å»è§£æ</view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-more" wx:if="{{loading && historyList.length > 0}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{!hasMore && historyList.length > 0}}">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>

  <!-- ç»´æŠ¤åŠŸèƒ½ï¼ˆé•¿æŒ‰å‡ºç°ï¼‰ -->
  <view class="maintenance-btn" bindlongpress="showMaintenanceMenu">
    <text class="maintenance-icon">âš™ï¸</text>
  </view>
</view>