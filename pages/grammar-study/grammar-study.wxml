<view class="container">
  <!-- å­¦ä¹ è¿›åº¦ -->
  <view class="progress-header">
    <text class="week-title">ç¬¬{{currentWeek}}å‘¨ - ç¬¬{{currentDay}}å¤©</text>
    <text class="week-theme">{{weekPlan.title}}</text>
    <text class="switch-mode-btn" bindtap="switchToLibrary">åˆ‡æ¢åˆ°è‡ªç”±å­¦ä¹  â†’</text>
  </view>

  <!-- ä»Šæ—¥ä»»åŠ¡ -->
  <view class="today-section" wx:if="{{!currentLesson}}">
    <!-- æ–°è¯¾å­¦ä¹  -->
    <view class="task-group" wx:if="{{todayLessons.length > 0}}">
      <view class="group-header">
        <text class="group-title">ğŸ“š ä»Šæ—¥æ–°è¯¾</text>
        <text class="group-count">{{todayLessons.length}}è¯¾</text>
      </view>
      <view class="lesson-list">
        <view 
          class="lesson-item {{studyProgress.completedLessons.includes(item.id) ? 'completed' : ''}}"
          wx:for="{{todayLessons}}" 
          wx:key="id"
          bindtap="startLesson"
          data-lesson="{{item}}"
        >
          <view class="lesson-info">
            <text class="lesson-title">{{item.title}}</text>
            <text class="lesson-grammar">{{item.grammar}}</text>
          </view>
          <view class="lesson-status">
            <text wx:if="{{studyProgress.completedLessons.includes(item.id)}}" class="status-icon">âœ…</text>
            <text wx:else class="start-btn">å¼€å§‹</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å¤ä¹ å†…å®¹ -->
    <view class="task-group" wx:if="{{todayReview.length > 0}}">
      <view class="group-header">
        <text class="group-title">ğŸ”„ ä»Šæ—¥å¤ä¹ </text>
        <text class="group-count">{{todayReview.length}}è¯¾</text>
      </view>
      <view class="lesson-list">
        <view 
          class="lesson-item review"
          wx:for="{{todayReview}}" 
          wx:key="id"
          bindtap="viewGrammarDetail"
          data-lesson="{{item}}"
        >
          <view class="lesson-info">
            <text class="lesson-title">{{item.title}}</text>
            <text class="lesson-grammar">{{item.grammar}}</text>
          </view>
          <text class="review-btn">å¤ä¹ </text>
        </view>
      </view>
    </view>

    <!-- å­¦ä¹ å»ºè®® -->
    <view class="tips-section">
      <text class="tips-title">ğŸ’¡ å­¦ä¹ å»ºè®®</text>
      <text class="tips-content">æ¯å¤©åšæŒç»ƒä¹ {{weekPlan.dailyPractice}}ä¸ªå¥å­ï¼Œå¾ªåºæ¸è¿›æŒæ¡è¯­æ³•ï¼</text>
    </view>
  </view>

  <!-- è¯¾ç¨‹è¯¦æƒ… -->
  <view class="lesson-detail" wx:if="{{currentLesson && !practiceMode}}">
    <view class="detail-header">
      <text class="back-btn" bindtap="backToList">â† è¿”å›</text>
      <text class="detail-title">{{currentLesson.title}}</text>
    </view>

    <!-- è¯­æ³•è¯´æ˜ -->
    <view class="grammar-section">
      <view class="section-title">ğŸ“– è¯­æ³•ç»“æ„</view>
      <view class="grammar-box">
        <text class="grammar-pattern">{{currentLesson.grammar}}</text>
        <text class="grammar-explain">{{currentLesson.explanation}}</text>
      </view>
    </view>

    <!-- ä¾‹å¥å±•ç¤º -->
    <view class="examples-section">
      <view class="section-title">ğŸ“ ä¾‹å¥å­¦ä¹ </view>
      <view class="example-list">
        <view class="example-card" wx:for="{{currentLesson.examples}}" wx:key="index">
          <view class="example-header" bindtap="playExample" data-text="{{item.jp}}">
            <text class="example-jp">{{item.jp}}</text>
            <text class="play-icon">ğŸ”Š</text>
          </view>
          <text class="example-kana">{{item.kana}}</text>
          <text class="example-romaji">{{item.romaji}}</text>
          <text class="example-cn">{{item.cn}}</text>
          <text class="example-grammar" wx:if="{{item.grammar}}">è¯­æ³•ï¼š{{item.grammar}}</text>
        </view>
      </view>
    </view>

    <!-- å¼€å§‹ç»ƒä¹ æŒ‰é’® -->
    <view class="action-section">
      <button class="practice-btn" bindtap="startPractice">å¼€å§‹ç»ƒä¹ </button>
    </view>
  </view>

  <!-- ç»ƒä¹ æ¨¡å¼ -->
  <view class="practice-section" wx:if="{{practiceMode}}">
    <view class="practice-header">
      <text class="practice-title">ç»ƒä¹ æ¨¡å¼</text>
      <text class="practice-progress">{{currentExampleIndex + 1}}/{{practiceExamples.length}}</text>
    </view>

    <!-- å½“å‰ç»ƒä¹ é¢˜ -->
    <view class="practice-content" wx:if="{{practiceExamples[currentExampleIndex]}}">
      <!-- å¡«ç©ºé¢˜ -->
      <view wx:if="{{practiceExamples[currentExampleIndex].type === 'fill'}}" class="fill-question">
        <text class="question-text">{{practiceExamples[currentExampleIndex].question}}</text>
        <input 
          class="answer-input"
          placeholder="è¯·è¾“å…¥ç­”æ¡ˆ"
          value="{{userAnswer}}"
          bindinput="onAnswerInput"
          disabled="{{showAnswer}}"
        />
      </view>

      <!-- ç¿»è¯‘é¢˜ -->
      <view wx:elif="{{practiceExamples[currentExampleIndex].type === 'translate'}}" class="translate-question">
        <text class="question-label">è¯·ç¿»è¯‘ä»¥ä¸‹å¥å­ï¼š</text>
        <text class="question-jp">{{practiceExamples[currentExampleIndex].jp}}</text>
        <text class="question-kana" wx:if="{{practiceExamples[currentExampleIndex].kana}}">{{practiceExamples[currentExampleIndex].kana}}</text>
        <textarea 
          class="translate-input"
          placeholder="è¯·è¾“å…¥ä¸­æ–‡ç¿»è¯‘"
          value="{{userAnswer}}"
          bindinput="onAnswerInput"
          disabled="{{showAnswer}}"
        />
      </view>

      <!-- ç­”æ¡ˆå±•ç¤º -->
      <view class="answer-section" wx:if="{{showAnswer}}">
        <view class="answer-result {{isCorrect ? 'correct' : 'incorrect'}}">
          <text wx:if="{{isCorrect}}">âœ… å›ç­”æ­£ç¡®ï¼</text>
          <text wx:else>âŒ å›ç­”é”™è¯¯</text>
        </view>
        <view class="correct-answer">
          <text class="answer-label">æ­£ç¡®ç­”æ¡ˆï¼š</text>
          <text class="answer-text">{{practiceExamples[currentExampleIndex].answer || practiceExamples[currentExampleIndex].cn}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="practice-actions">
        <button wx:if="{{!showAnswer}}" class="check-btn" bindtap="checkAnswer">æ£€æŸ¥ç­”æ¡ˆ</button>
        <button wx:else class="next-btn" bindtap="nextExample">
          {{currentExampleIndex < practiceExamples.length - 1 ? 'ä¸‹ä¸€é¢˜' : 'å®Œæˆç»ƒä¹ '}}
        </button>
      </view>
    </view>
  </view>
</view>

