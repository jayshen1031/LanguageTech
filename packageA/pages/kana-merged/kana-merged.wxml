<view class="container">
  <!-- 顶部导航 -->
  <view class="header">
    <view class="header-title">假名学习</view>
    <view class="header-actions">
      <text class="action-btn" bindtap="toggleViewMode">
        {{viewMode === 'grid' ? '列表' : '网格'}}
      </text>
      <text class="action-btn primary" bindtap="startPractice">练习</text>
    </view>
  </view>

  <!-- 假名类型切换 -->
  <view class="type-tabs">
    <view 
      class="tab-item {{activeType === 'seion' ? 'active' : ''}}"
      bindtap="switchType"
      data-type="seion"
    >
      清音
    </view>
    <view 
      class="tab-item {{activeType === 'dakuon' ? 'active' : ''}}"
      bindtap="switchType"
      data-type="dakuon"
    >
      浊音
    </view>
    <view 
      class="tab-item {{activeType === 'handakuon' ? 'active' : ''}}"
      bindtap="switchType"
      data-type="handakuon"
    >
      半浊音
    </view>
    <view 
      class="tab-item {{activeType === 'youon' ? 'active' : ''}}"
      bindtap="switchType"
      data-type="youon"
    >
      拗音
    </view>
  </view>

  <!-- 显示设置 -->
  <view class="display-settings">
    <view class="setting-group">
      <text class="setting-label">显示内容：</text>
      <view class="setting-options">
        <label class="checkbox-label">
          <checkbox checked="{{showHiragana}}" bindtap="toggleDisplay" data-type="hiragana" />
          <text>平假名</text>
        </label>
        <label class="checkbox-label">
          <checkbox checked="{{showKatakana}}" bindtap="toggleDisplay" data-type="katakana" />
          <text>片假名</text>
        </label>
        <label class="checkbox-label">
          <checkbox checked="{{showRomaji}}" bindtap="toggleDisplay" data-type="romaji" />
          <text>罗马音</text>
        </label>
      </view>
    </view>
    
    <view class="setting-group">
      <text class="setting-label">字体大小：</text>
      <view class="size-options">
        <text 
          class="size-btn {{fontSize === 'small' ? 'active' : ''}}"
          bindtap="changeFontSize"
          data-size="small"
        >小</text>
        <text 
          class="size-btn {{fontSize === 'medium' ? 'active' : ''}}"
          bindtap="changeFontSize"
          data-size="medium"
        >中</text>
        <text 
          class="size-btn {{fontSize === 'large' ? 'active' : ''}}"
          bindtap="changeFontSize"
          data-size="large"
        >大</text>
      </view>
    </view>
  </view>

  <!-- 假名内容区 -->
  <view class="content-area" wx:if="{{!practiceMode}}">
    <!-- 网格视图 -->
    <view wx:if="{{viewMode === 'grid'}}" class="kana-grid {{fontSize}}">
      <view 
        wx:for="{{currentKanaList}}" 
        wx:key="index"
        class="kana-cell {{item.type === 'empty' ? 'empty' : ''}} {{item['animation_' + index] ? 'animated' : ''}}"
        bindtap="playSound"
        data-hiragana="{{item.hiragana}}"
        data-romaji="{{item.romaji}}"
        data-index="{{index}}"
      >
        <view wx:if="{{item.type !== 'empty'}}" class="kana-content">
          <text wx:if="{{showHiragana}}" class="hiragana">{{item.hiragana}}</text>
          <text wx:if="{{showKatakana}}" class="katakana">{{item.katakana}}</text>
          <text wx:if="{{showRomaji}}" class="romaji">{{item.romaji}}</text>
        </view>
      </view>
    </view>

    <!-- 列表视图 -->
    <scroll-view wx:else scroll-y class="kana-list {{fontSize}}">
      <view 
        wx:for="{{currentKanaList}}" 
        wx:key="index"
        wx:if="{{item.type !== 'empty'}}"
        class="kana-list-item {{item['animation_' + index] ? 'animated' : ''}}"
        bindtap="playSound"
        data-hiragana="{{item.hiragana}}"
        data-romaji="{{item.romaji}}"
        data-index="{{index}}"
      >
        <view class="kana-group">
          <text wx:if="{{showHiragana}}" class="hiragana">{{item.hiragana}}</text>
          <text wx:if="{{showKatakana}}" class="katakana">{{item.katakana}}</text>
        </view>
        <text wx:if="{{showRomaji}}" class="romaji">{{item.romaji}}</text>
        <view class="row-label">{{item.row}}行</view>
      </view>
    </scroll-view>
  </view>

  <!-- 练习模式 -->
  <view wx:else class="practice-mode">
    <view class="practice-header">
      <text class="practice-title">假名练习</text>
      <text class="practice-score">{{stats.correct}}/{{stats.total}}</text>
    </view>

    <view wx:if="{{currentQuestion}}" class="practice-content">
      <!-- 题目 -->
      <view class="question-card">
        <view class="question-kana">
          <text wx:if="{{showHiragana}}" class="hiragana-large">{{currentQuestion.hiragana}}</text>
          <text wx:if="{{showKatakana}}" class="katakana-large">{{currentQuestion.katakana}}</text>
        </view>
        <text class="question-prompt">请选择正确的罗马音</text>
      </view>

      <!-- 选项 -->
      <view class="options-grid">
        <view 
          wx:for="{{options}}" 
          wx:key="item"
          class="option-btn {{showResult && item === currentQuestion.romaji ? 'correct' : ''}} {{showResult && item === userAnswer && !isCorrect ? 'wrong' : ''}}"
          bindtap="{{!showResult ? 'selectAnswer' : ''}}"
          data-answer="{{item}}"
        >
          {{item}}
        </view>
      </view>

      <!-- 结果反馈 -->
      <view wx:if="{{showResult}}" class="result-feedback">
        <text class="result-text {{isCorrect ? 'correct' : 'wrong'}}">
          {{isCorrect ? '✓ 正确！' : '✗ 错误'}}
        </text>
        <view wx:if="{{!isCorrect}}" class="correct-answer">
          正确答案：{{currentQuestion.romaji}}
        </view>
        <button class="next-btn" bindtap="nextQuestion">下一题</button>
      </view>
    </view>

    <button class="exit-btn" bindtap="exitPractice">退出练习</button>
  </view>

  <!-- 底部工具栏 -->
  <view class="toolbar">
    <button class="tool-btn" bindtap="quickMemory">快速记忆</button>
    <button class="tool-btn" open-type="share">分享给朋友</button>
  </view>
</view>